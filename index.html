<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>議員リスト（SearchPanes付き）</title>

  <!-- DataTables & SearchPanes CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.2.0/css/searchPanes.dataTables.min.css" />

  <style>
    .dt-searchPanes {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>議員リスト</h1>

  <table id="gijiin-table" class="display" style="width:100%">
    <thead>
      <tr></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- jQuery & DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/searchpanes/2.2.0/js/dataTables.searchPanes.min.js"></script>
  <script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js"></script>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR1giM0QVguQyfZuo0KA4cJX2xV2QyFjBHNNRgFbX7DdsPqh4ADmRcEM6BaZHgmhk08JG5UeByIloJo/pub?gid=0&single=true&output=csv";

    async function loadCSVtoTable() {
      const res = await fetch(SHEET_URL);
      const text = await res.text();
      const rows = text.trim().split("\n").map(row => row.split(","));
      const headers = rows[0];
      const data = rows.slice(1);

      const thead = $("#gijiin-table thead tr");
      headers.forEach(h => thead.append(`<th>${h}</th>`));

      $('#gijiin-table').DataTable({
        data: data,
        columns: headers.map(h => ({ title: h })),
        paging: false,
        dom: 'Plfrtip',  // ✅ SearchPanesを含めたUI構成
        searchPanes: {
          cascadePanes: true,
          dtOpts: {
            paging: false,
            searching: false
          }
        },
        columnDefs: headers.map((_, index) => ({
          searchPanes: {
            show: true
          },
          targets: index
        }))
      });
    }

    loadCSVtoTable();
  </script>
</body>
</html>
